<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abonnements - Gestion</title>
  <link rel="stylesheet" href="/academic.css">
</head>
<body>

<!-- Navigation -->
<nav class="navbar">
  <div class="container">
    <a class="navbar-brand" href="/index.html">
      ðŸ“‹ Dashboard Abonnements
    </a>
    <div style="display: inline-block; margin-left: auto;">
      <a href="/index.html">Dashboard</a>
      <a href="/subscriptions.html">Abonnements</a>
      <a href="/stats.html">Statistiques</a>
    </div>
  </div>
</nav>

<!-- Contenu principal -->
<main class="container">
  <h1 style="margin-bottom: 2rem;">Gestion des abonnements</h1>

  <!-- Formulaire crÃ©ation/modification -->
  <section class="section">
    <h2 class="section-title">CrÃ©er/Modifier un abonnement</h2>
    <div id="subscription-form">
      <!-- Formulaire injectÃ© par JavaScript -->
    </div>
  </section>

  <!-- Liste des abonnements -->
  <section class="section">
    <h2 class="section-title">Liste des abonnements</h2>
    <div style="margin-bottom: 1rem;">
      <input 
        type="text" 
        id="search-input" 
        class="form-control" 
        placeholder="Rechercher par client ou service..."
        style="max-width: 400px;">
    </div>
    <div id="subscriptions-table">
      <!-- Tableau injectÃ© par JavaScript -->
    </div>
  </section>
</main>

<!-- Scripts -->
<script src="/api.js"></script>
<script src="/ui.js"></script>
<script>
/**
 * PAGE: Gestion CRUD des abonnements
 */

let allAbonnements = [];
let editingId = null;

/**
 * Charge la page et affiche tous les abonnements
 */
async function loadSubscriptionsPage() {
  try {
    allAbonnements = await fetchAbonnements();
    
    // Afficher le formulaire de crÃ©ation
    renderSubscriptionForm(null);
    
    // Afficher la liste
    renderSubscriptionsTable(allAbonnements);
  } catch (error) {
    console.error('Erreur:', error);
    showError('Erreur lors du chargement des abonnements');
  }
}

/**
 * Ã‰diter un abonnement
 */
async function editSubscriptionId(id) {
  const ab = allAbonnements.find(a => a.id === id);
  if (ab) {
    editingId = id;
    renderSubscriptionForm(ab);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}

/**
 * Supprimer un abonnement
 */
async function deleteSubscriptionId(id) {
  if (!confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cet abonnement?')) {
    return;
  }
  
  const success = await deleteAbonnement(id);
  if (success) {
    showSuccess('âœ… Abonnement supprimÃ©');
    loadSubscriptionsPage();
  } else {
    showError('âŒ Erreur lors de la suppression');
  }
}

/**
 * Recherche/Filtre en temps rÃ©el
 */
document.addEventListener('DOMContentLoaded', () => {
  loadSubscriptionsPage();
  
  const searchInput = document.getElementById('search-input');
  if (searchInput) {
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      const filtered = allAbonnements.filter(ab =>
        (ab.client && ab.client.toLowerCase().includes(query)) ||
        (ab.service && ab.service.toLowerCase().includes(query))
      );
      renderSubscriptionsTable(filtered);
    });
  }
});
</script>

</body>
</html>
