<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Gestion d'Abonnements</title>
  <link rel="stylesheet" href="/academic.css">
</head>
<body>

<!-- Navigation -->
<nav class="navbar">
  <div class="container">
    <a class="navbar-brand" href="/index.html">
      üìã Dashboard Abonnements
    </a>
    <div style="display: inline-block; margin-left: auto;">
      <a href="/index.html">Dashboard</a>
      <a href="/subscriptions.html">Abonnements</a>
      <a href="/stats.html">Statistiques</a>
    </div>
  </div>
</nav>

<!-- Contenu principal -->
<main class="container">
  <h1 style="margin-bottom: 2rem;">Dashboard - Vue d'ensemble</h1>

  <!-- KPIs -->
  <section class="section">
    <h2 class="section-title">M√©triques principales</h2>
    <div id="kpi-container" class="kpi-grid">
      <!-- Cartes KPI inject√©es par JavaScript -->
    </div>
  </section>

  <!-- Abonnements √† risque -->
  <section class="section">
    <h2 class="section-title">‚ö†Ô∏è Abonnements √† risque</h2>
    <div id="risk-list">
      <!-- Liste des abonnements √† risque -->
    </div>
  </section>

  <!-- Dernier abonnement cr√©√© -->
  <section class="section">
    <h2 class="section-title">Informations du syst√®me</h2>
    <p id="system-info">Chargement...</p>
  </section>
</main>

<!-- Scripts -->
<script src="/api.js"></script>
<script src="/ui.js"></script>
<script>
/**
 * PAGE: Dashboard principal
 * Affiche les KPIs et les abonnements √† risque du backend
 */

async function loadDashboard() {
  try {
    // R√©cup√©rer les donn√©es du backend
    const abonnements = await fetchAbonnements();
    const analytics = await fetchAnalytics();

    // Afficher les KPIs
    renderDashboardKPIs(analytics);

    // Afficher les abonnements √† risque
    const riskAbs = abonnements.filter(ab => ab.riskLevel === 'high' || ab.daysUntilExpiry < 30);
    renderRiskList(riskAbs);

    // Afficher les infos syst√®me
    const info = `
      Total d'abonnements: ${abonnements.length} | 
      Co√ªt mensuel estim√©: ${formatCurrency(analytics.coutMensuel)} | 
      Sant√© du portefeuille: ${analytics.scoreSante}%
    `;
    document.getElementById('system-info').textContent = info;
  } catch (error) {
    console.error('Erreur lors du chargement du dashboard:', error);
    showError('Erreur de chargement du dashboard');
  }
}

// Charger au d√©marrage
window.addEventListener('DOMContentLoaded', loadDashboard);

// Rafra√Æchir toutes les 5 minutes
setInterval(loadDashboard, 5 * 60 * 1000);
</script>

</body>
</html>
